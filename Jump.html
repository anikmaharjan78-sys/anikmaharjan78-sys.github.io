<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Simple Jumping Game</title>
  <style>
    body { margin: 0; background: #87ceeb; overflow: hidden; }
    canvas { background: #cfe9ff; display: block; margin: 0 auto; border: 3px solid #333; }
  </style>
</head>
<body>
<canvas id="game" width="800" height="400"></canvas>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const W = canvas.width, H = canvas.height;

// game variables
let player, platforms, obstacles, finish, cameraX, keys = {};
let gameState = "start"; // "start", "playing", "win", "lose"
let score = 0;

const gravity = 0.8, jumpPower = -12, speed = 4, levelWidth = 3000;

function resetGame() {
  player = { x: 50, y: H-100, w: 40, h: 40, vx: 0, vy: 0, onGround: false, jumping: false };
  cameraX = 0;
  keys = {};
  score = 0;
  gameState = "start"; // show instructions first

  platforms = [
    {x:0, y:H-60, w:levelWidth, h:60}, // ground
    {x:300, y:H-150, w:100, h:20},
    {x:600, y:H-200, w:120, h:20},
    {x:1000, y:H-180, w:150, h:20},
    {x:1400, y:H-220, w:120, h:20}
  ];

  obstacles = [
    {x:500, y:H-80, w:30, h:20},
    {x:900, y:H-80, w:30, h:20},
    {x:1600, y:H-80, w:30, h:20}
  ];

  finish = {x: levelWidth-100, y:H-260, w:40, h:200};
}

function rect(r, color) { ctx.fillStyle = color; ctx.fillRect(r.x - cameraX, r.y, r.w, r.h); }

function update() {
  if(gameState !== "playing") return; // only update in playing state

  // move
  if(keys["ArrowRight"] || keys["d"]) player.vx = speed;
  else if(keys["ArrowLeft"] || keys["a"]) player.vx = -speed;
  else player.vx = 0;

  if((keys[" "] || keys["ArrowUp"] || keys["w"]) && player.onGround && !player.jumping) {
    player.vy = jumpPower;
    player.onGround = false;
    player.jumping = true;
  }

  // physics
  player.vy += gravity;
  player.x += player.vx;
  player.y += player.vy;

  // collisions with platforms
  player.onGround = false;
  for(let p of platforms) {
    if(player.x < p.x+p.w && player.x+player.w > p.x && player.y < p.y+p.h && player.y+player.h > p.y) {
      if(player.vy >= 0 && player.y+player.h - player.vy <= p.y) {
        player.y = p.y - player.h;
        player.vy = 0;
        player.onGround = true;
        player.jumping = false;
      }
    }
  }

  // lose if hit spikes
  for(let s of obstacles) {
    if(player.x < s.x+s.w && player.x+player.w > s.x && player.y < s.y+s.h && player.y+player.h > s.y) {
      gameState = "lose";
    }
  }

  // lose if fall off screen
  if(player.y > H) {
    gameState = "lose";
  }

  // win if reach finish
  if(player.x+player.w > finish.x && player.y+player.h > finish.y) {
    gameState = "win";
  }

  // camera
  cameraX = player.x - W/2;
  if(cameraX < 0) cameraX = 0;
  if(cameraX > levelWidth-W) cameraX = levelWidth-W;

  // score = distance traveled
  score = Math.max(score, Math.floor(player.x));
}

function draw() {
  ctx.clearRect(0,0,W,H);

  // draw level
  for(let p of platforms) rect(p, "#228B22");
  for(let s of obstacles) rect(s, "#b00");
  rect(finish, "#ff0");
  rect(player, "#33c");

  // HUD
  ctx.fillStyle = "#000";
  ctx.font = "18px Arial";
  if(gameState === "playing") ctx.fillText("Score: " + score + " px", 20, 30);

  // messages
  if(gameState === "start") {
    ctx.fillStyle = "black";
    ctx.font = "28px Arial";
    ctx.fillText("Welcome to the Jumping Game!", W/2-200, H/2-40);
    ctx.font = "20px Arial";
    ctx.fillText("Controls: Arrow keys / A D to move, Space/W/â†‘ to jump", W/2-250, H/2);
    ctx.fillText("Avoid spikes, reach the yellow finish line!", W/2-200, H/2+30);
    ctx.fillText("Press ENTER to Start", W/2-120, H/2+80);
  }

  if(gameState === "win") {
    ctx.fillStyle = "green";
    ctx.font = "40px Arial";
    ctx.fillText("YOU WIN!", W/2-100, H/2-20);
    ctx.font = "20px Arial";
    ctx.fillText("Final Score: " + score + " px", W/2-80, H/2+20);
    ctx.fillText("Press R to Restart", W/2-90, H/2+60);
  }

  if(gameState === "lose") {
    ctx.fillStyle = "red";
    ctx.font = "40px Arial";
    ctx.fillText("YOU LOSE!", W/2-110, H/2-20);
    ctx.font = "20px Arial";
    ctx.fillText("Final Score: " + score + " px", W/2-80, H/2+20);
    ctx.fillText("Press R to Restart", W/2-90, H/2+60);
  }
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

// keys
document.addEventListener("keydown", e => {
  keys[e.key] = true;
  if(gameState === "start" && e.key === "Enter") gameState = "playing";
});
document.addEventListener("keyup", e => {
  keys[e.key] = false;
  if (e.key === "r" || e.key === "R") resetGame();
});

// start
resetGame();
loop();
</script>
</body>
</html>
